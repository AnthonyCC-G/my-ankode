{% extends 'base.html.twig' %}

{% block title %}Connexion / Inscription - My-Ankode{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/auth.css') }}">
{% endblock %}

{% block body %}
    {# ===== MESSAGES FLASH ===== #}
    {% for message in app.flashes('success') %}
        <div class="flash-message flash-message--success">
            <span>{{ message }}</span>
                <button type="button" class="flash-message__close" onclick="this.parentElement.remove()">×</button>
        </div>
    {% endfor %}

    {% for message in app.flashes('error') %}
        <div class="flash-message flash-message--error">
            <span>{{ message }}</span>
                <button type="button" class="flash-message__close" onclick="this.parentElement.remove()">×</button>
        </div>
                {% endfor %}
    <div class="auth-page-wrapper">
        <h1 class="visually-hidden">Connexion et inscription - My Ankode</h1>

        {# Erreurs inscription - gauche #}
        <div class="auth-errors auth-errors--register">
            {{ form_errors(registrationForm.username) }}
            {{ form_errors(registrationForm.email) }}
            {{ form_errors(registrationForm.plainPassword) }}
            {{ form_errors(registrationForm.agreeTerms) }}
            {{ form_errors(registrationForm.agreeDataCollection) }}
        </div>

        {# Erreurs connexion - droite #}
        <div class="auth-errors auth-errors--login">
            {% if login_error %}
                {{ login_error.messageKey|trans(login_error.messageData, 'security') }}
            {% endif %}
        </div>


            <div class="auth-container">
                {# ===== DIV2 : BLOC INSCRIPTION ===== #}
                <section class="auth-block auth-block--register">
                    <h2 class="auth-block__title">if (!compte) { S'inscrire }</h2>
                    
                    {{ form_start(registrationForm, {'attr': {'class': 'auth-form', 'novalidate': 'novalidate'}}) }}
                    
                    {# Username #}
                    <div class="form-group">
                        <label for="{{ registrationForm.username.vars.id }}" class="form-label">
                            username = <span class="required" aria-hidden="true">// required</span>
                        </label>
                        {{ form_widget(registrationForm.username, {'attr': {'class': 'form-input', 'placeholder': 'Votre identifiant'}}) }}
                    </div>

                    {# Email #}
                    <div class="form-group">
                        <label for="{{ registrationForm.email.vars.id }}" class="form-label">
                            email = <span class="required">// required</span>
                        </label>
                        {{ form_widget(registrationForm.email, {'attr': {'class': 'form-input', 'placeholder': 'votre@email.com'}}) }}
                    </div>

                    {# Mot de passe #}
                    <div class="form-group">
                        <label for="{{ registrationForm.plainPassword.vars.id }}" class="form-label">
                            motDePasse = <span class="required">// required</span>
                        </label>
                        {{ form_widget(registrationForm.plainPassword, {'attr': {'class': 'form-input', 'placeholder': 'Mot de passe'}}) }}
                        <span class="form-hint">/* Min. 16 caracteres - Majuscules, minuscules, chiffres et caractere special */</span>
                    </div>

                    {# IMAGE JENNY #} 
                    <div class="auth-illustration">
                        <img src="{{ asset('images/Jenny.png') }}" alt="Image d'une développeuse contente" class="auth-illustration__img">
                    </div>

                    {# Checkbox CGU - avec lien vers mentions legales #}
                    <div class="form-group form-group--checkbox">
                        {{ form_widget(registrationForm.agreeTerms, {'attr': {'class': 'form-checkbox'}}) }}
                        <label for="{{ registrationForm.agreeTerms.vars.id }}" class="form-label-checkbox">
                            J'accepte les <a href="{{ path('app_legal_mentions') }}" target="_blank" class="auth-link">conditions d'utilisation</a>
                        </label>
                    </div>

                    {# Checkbox collecte de donnees - avec lien vers page RGPD #}
                    <div class="form-group form-group--checkbox">
                        {{ form_widget(registrationForm.agreeDataCollection, {'attr': {'class': 'form-checkbox'}}) }}
                        <label for="{{ registrationForm.agreeDataCollection.vars.id }}" class="form-label-checkbox">
                            J'ai pris connaissance de la <a href="{{ path('app_legal_mentions') }}#rgpd" target="_blank" class="auth-link">politique de collecte des données.</a>
                        </label>
                    </div>

                    <button type="submit" class="btn btn--primary">S'inscrire</button>

                    {{ form_end(registrationForm) }}
                    
                    {#<p class="auth-block__closing">}</p>#}
                </section>

                {# ===== DIV3 : BLOC CONNEXION ===== #}
                <section class="auth-block auth-block--login">
                    <h2 class="auth-block__title"> else { Se connecter }</h2>

                    {# Erreurs de connexion #}
                    {% if login_error %}
                        <div class="flash-message flash-message--error">
                            {{ login_error.messageKey|trans(login_error.messageData, 'security') }}
                        </div>
                    {% endif %}

                    <form method="post" action="{{ path('app_auth') }}" class="auth-form">
                        {# Email #}
                        <div class="form-group">
                            <label for="inputEmail" class="form-label">email = <span class="required">// required</span></label>
                            <input type="email" 
                                id="inputEmail" 
                                name="email" 
                                class="form-input" 
                                value="{{ last_username }}" 
                                required 
                                autofocus
                                placeholder="votre@email.com">
                        </div>

                        {# Mot de passe #}
                        <div class="form-group">
                            <label for="inputPassword" class="form-label">motDePasse = <span class="required">// required</span></label>
                            <input type="password" 
                                id="inputPassword" 
                                name="password" 
                                class="form-input" 
                                required
                                placeholder="Votre mot de passe">
                        </div>

                        {#  SPACER INVISIBLE pour aligner David avec Jenny #}
                        <div class="form-group form-group--spacer" aria-hidden="true"></div>

                        <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}">

                        {# IMAGE DAVID #}
                        <div class="auth-illustration" id="David">
                            <img src="{{ asset('images/David.png') }}" alt="Image d'un developpeur avec une tasse de café" class="auth-illustration__img">
                        </div>

                        {# Remember me #}
                        <div class="form-group form-group--checkbox">
                            <input type="checkbox" 
                                class="form-checkbox" 
                                id="remember_me" 
                                name="_remember_me">
                            <label class="form-label-checkbox" for="remember_me">
                                Se souvenir de moi
                            </label>
                        </div>

                        <button type="submit" class="btn btn--primary">Se connecter</button>
                    </form>
                    
                    {#<p class="auth-block__closing">}</p>#}
                </section>

            </div>
    </div>
{% endblock %}